#!/usr/bin/env ruby

require 'rubygems'
require "#{File.dirname(__FILE__)}/../lib/bananajour"

Bananajour.setup! unless Bananajour.setup?

case ARGV.first

when nil
  Bananajour.serve_web!
  Bananajour.serve_git!
  Bananajour.advertise!
  Bananajour.repositories.each {|r| r.advertise!}
  Process.wait

when "init"
  Bananajour.init!(ARGV[1] || File.expand_path("."))
  
when "help", "--help", "-h"
  puts <<-HELP
Usage: #{File.basename($0)} [<command>]

Commands:
  none       - Start the web, git and bonjour serving
  init [path] - Inits a new bananajour repository
HELP

else
  STDERR.puts "Say what? Try: #{File.basename($0)} help"
  exit(1)
end
