#!/usr/bin/env ruby

require 'rubygems'
require "#{File.dirname(__FILE__)}/../lib/bananajour"

Bananajour.check_git!

Bananajour.setup! unless Bananajour.setup?

case ARGV.first

when nil
  Bananajour.serve_web!
  Bananajour.serve_git!
  Bananajour.advertise!
  Bananajour.repositories.each {|r| r.advertise!}
  Process.wait

when "init"
  repo = Bananajour.init!(ARGV[1] || File.expand_path("."))
  repo.advertise!

when "help", "--help", "-h"
  puts <<-HELP
Usage: #{File.basename($0)} [<command>]

Commands:
  none       - Start the web, git and bonjour serving
  init [path] - Inits a new bananajour repository
HELP

when 'others'
  Bananajour.people.each do |p|
    puts p.name + ' - ' + p.uri
  end

when 'test'
  

else
  STDERR.puts "Say what? Try: #{File.basename($0)} help"
  exit(1)
end
